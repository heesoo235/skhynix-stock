{% extends "base.html" %}
{% block title %}주가 예측{% endblock %}

{% block content %}
<div class="mt-5 p-4 bg-light rounded shadow-sm">
    <h2 class="mb-4">📈 AI 주가 예측</h2>

    <!-- 예측 실행 버튼 -->
    <form method="post" class="mb-3">
        <button type="submit" class="btn btn-primary">오늘 게시글 기반 예측 실행</button>
    </form>

    <!-- 예측 결과 출력 -->
    {% if prediction %}
    <div class="alert alert-success mt-4">
        <h5>🔍 분석 요약</h5>
        <p><strong>감성 분석 결과:</strong> {{ sentiment }}
        {% if score is not none %}
            (점수: {{ score | round(2) }})
        {% else %}
            (점수 정보 없음)
        {% endif %}
        </p>
        <p><strong>📊 주가 예측:</strong> {{ prediction }}</p>
    </div>

    <!-- 현재 주가 정보 출력 -->
    {% if current_price and current_volume %}
    <div class="alert alert-info">
        <h6>📌 현재 SK하이닉스 주가</h6>
        <p><strong>종가:</strong> {{ current_price | int }}원<br>
           <strong>거래량:</strong> {{ "{:,}".format(current_volume) }}주</p>
    </div>
    {% endif %}

    <!-- 자세히 보기 버튼 -->
    <form method="get" action="{{ url_for('stock_predict_detail') }}">
        <button type="submit" class="btn btn-outline-secondary mt-2">자세히 보기</button>
    </form>
    {% endif %}

    <!-- 차트 -->
    {% if chart_data %}
    <div class="mt-5">
        <h5>📉 최근 7일간 주가 추이</h5>
        <canvas id="stockChart" height="100"></canvas>
    </div>
    {% endif %}
</div>

<!-- Chart.js CDN & 스크립트 -->
{% if chart_data %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    const ctx = document.getElementById('stockChart').getContext('2d');
    const stockChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: {{ chart_data.dates | tojson }},
            datasets: [{
                label: '종가 (원)',
                data: {{ chart_data.closes | tojson }},
                borderColor: 'rgba(75, 192, 192, 1)',
                backgroundColor: 'rgba(75, 192, 192, 0.1)',
                tension: 0.3,
                fill: true,
                pointRadius: 4,
                pointHoverRadius: 6
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    ticks: {
                        callback: function(value) {
                            return value.toLocaleString() + '원';
                        }
                    }
                }
            }
        }
    });
});
</script>
{% endif %}
{% endblock %}
