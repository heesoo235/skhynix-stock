{% extends "base.html" %}
{% block title %}ê²Œì‹œê¸€ ê¸°ë°˜ ì£¼ê°€ ì˜ˆì¸¡{% endblock %}

{% block content %}
<div class="mt-5 p-4 bg-light rounded shadow-sm">
    <h2 class="mb-4">ğŸ“ˆ ì˜¤ëŠ˜ì ê²Œì‹œê¸€ ê¸°ë°˜ AI ì£¼ê°€ ì˜ˆì¸¡</h2>

    <!-- ì˜ˆì¸¡ ì‹¤í–‰ ë²„íŠ¼ -->
    <form method="post" action="{{ url_for('stock_predict') }}" class="mb-3">
        <button type="submit" class="btn btn-primary">ì˜¤ëŠ˜ ê²Œì‹œê¸€ ì˜ˆì¸¡ ì‹¤í–‰</button>
    </form>

    <!-- ì˜ˆì¸¡ ê²°ê³¼ê°€ ìˆì„ ë•Œë§Œ ì¶œë ¥ -->
    {% if results %}
    <h5 class="mt-4">ğŸ” ì˜ˆì¸¡ ê²°ê³¼</h5>
    <table class="table table-striped table-bordered mt-2">
        <thead class="thead-light">
            <tr>
                <th>ID</th>
                <th>ì œëª©</th>
                <th>ë‚´ìš©</th>
                <th>ì˜ˆì¸¡</th>
                <th>ìƒìŠ¹ í™•ë¥ </th>
                <th>í•˜ë½ í™•ë¥ </th>
            </tr>
        </thead>
        <tbody>
            {% for item in results %}
            <tr>
                <td>{{ item.id }}</td>
                <td>{{ item.title }}</td>
                <td>{{ item.content }}</td>
                <td>{{ item.prediction }}</td>
                <td>{{ item.up_prob }}</td>
                <td>{{ item.down_prob }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- ìì„¸íˆ ë³´ê¸° ë²„íŠ¼ -->
    <form method="get" action="{{ url_for('stock_predict_detail') }}">
        <button type="submit" class="btn btn-outline-secondary">ìì„¸íˆ ë³´ê¸°</button>
    </form>
    {% endif %}

    <!-- ì°¨íŠ¸ -->
    {% if chart_data %}
    <div class="mt-5">
        <h5>ğŸ“‰ ìµœê·¼ 7ì¼ê°„ ì£¼ê°€ ì¶”ì´</h5>
        <canvas id="stockChart" height="100"></canvas>
    </div>
    {% endif %}
</div>

<!-- Chart.js CDN & ìŠ¤í¬ë¦½íŠ¸ -->
{% if chart_data %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    const ctx = document.getElementById('stockChart').getContext('2d');
    const stockChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: {{ chart_data.dates | tojson }},
            datasets: [{
                label: 'ì¢…ê°€ (ì›)',
                data: {{ chart_data.closes | tojson }},
                borderColor: 'rgba(75, 192, 192, 1)',
                backgroundColor: 'rgba(75, 192, 192, 0.1)',
                tension: 0.3,
                fill: true,
                pointRadius: 4,
                pointHoverRadius: 6
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    ticks: {
                        callback: function(value) {
                            return value.toLocaleString() + 'ì›';
                        }
                    }
                }
            }
        }
    });
});
</script>
{% endif %}
{% endblock %}
