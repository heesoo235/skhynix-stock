{% extends "base.html" %}
{% block title %}ì£¼ê°€ ì˜ˆì¸¡{% endblock %}

{% block content %}
<div class="mt-5 p-4 bg-light rounded shadow-sm">
    <h2 class="mb-4">ğŸ“ˆ AI ì£¼ê°€ ì˜ˆì¸¡</h2>

    <!-- ì˜ˆì¸¡ ì‹¤í–‰ ë²„íŠ¼ -->
    <form method="post" class="mb-3">
        <button type="submit" class="btn btn-primary">ì˜¤ëŠ˜ ê²Œì‹œê¸€ ê¸°ë°˜ ì˜ˆì¸¡ ì‹¤í–‰</button>
    </form>

    <!-- ì˜ˆì¸¡ ê²°ê³¼ ì¶œë ¥ -->
    {% if prediction %}
    <div class="alert alert-success mt-4">
        <h5>ğŸ” ë¶„ì„ ìš”ì•½</h5>
        <p><strong>ê°ì„± ë¶„ì„ ê²°ê³¼:</strong> {{ sentiment }}
        {% if score is not none %}
            (ì ìˆ˜: {{ score | round(2) }})
        {% else %}
            (ì ìˆ˜ ì •ë³´ ì—†ìŒ)
        {% endif %}
        </p>
        <p><strong>ğŸ“Š ì£¼ê°€ ì˜ˆì¸¡:</strong> {{ prediction }}</p>
    </div>

    <!-- í˜„ì¬ ì£¼ê°€ ì •ë³´ ì¶œë ¥ -->
    {% if current_price and current_volume %}
    <div class="alert alert-info">
        <h6>ğŸ“Œ í˜„ì¬ SKí•˜ì´ë‹‰ìŠ¤ ì£¼ê°€</h6>
        <p><strong>ì¢…ê°€:</strong> {{ current_price | int }}ì›<br>
           <strong>ê±°ë˜ëŸ‰:</strong> {{ "{:,}".format(current_volume) }}ì£¼</p>
    </div>
    {% endif %}

    <!-- ìì„¸íˆ ë³´ê¸° ë²„íŠ¼ -->
    <form method="get" action="{{ url_for('stock_predict_detail') }}">
        <button type="submit" class="btn btn-outline-secondary mt-2">ìì„¸íˆ ë³´ê¸°</button>
    </form>
    {% endif %}

    <!-- ì°¨íŠ¸ -->
    {% if chart_data %}
    <div class="mt-5">
        <h5>ğŸ“‰ ìµœê·¼ 7ì¼ê°„ ì£¼ê°€ ì¶”ì´</h5>
        <canvas id="stockChart" height="100"></canvas>
    </div>
    {% endif %}
</div>

<!-- Chart.js CDN & ìŠ¤í¬ë¦½íŠ¸ -->
{% if chart_data %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    const ctx = document.getElementById('stockChart').getContext('2d');
    const stockChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: {{ chart_data.dates | tojson }},
            datasets: [{
                label: 'ì¢…ê°€ (ì›)',
                data: {{ chart_data.closes | tojson }},
                borderColor: 'rgba(75, 192, 192, 1)',
                backgroundColor: 'rgba(75, 192, 192, 0.1)',
                tension: 0.3,
                fill: true,
                pointRadius: 4,
                pointHoverRadius: 6
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    ticks: {
                        callback: function(value) {
                            return value.toLocaleString() + 'ì›';
                        }
                    }
                }
            }
        }
    });
});
</script>
{% endif %}
{% endblock %}
